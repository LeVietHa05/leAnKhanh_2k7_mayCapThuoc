<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bè Thông Minh</title>
  <meta name="description" content="For monitoring the quality of water in HCM city">
  <link rel="stylesheet" href="stylesheets/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <!-- CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous" />
  <style>
    body {
      min-height: 100vh;
      background: linear-gradient(to bottom left, #f5bd2b, #dbef8d, #bcf166, #cfffee, #5bf3c6, #b5ffff);
      background-repeat: no-repeat;
    }

    main {
      backdrop-filter: blur(3px);
      background: rgb(255, 255, 255, 0.7);
      box-shadow: 0 0 50px 0 rgba(0, 0, 0, 0.23);
    }
  </style>
</head>

<body class="d-flex justify-content-center align-items-center">
  <div class="container">
    <main style="max-width: 600px; min-height: 95vh; min-width: 500px" class="m-auto rounded-4 p-3">
      <h1 class="text-center">Thiết bị cấp thuốc thông minh</h1>
      <div id="hello_js" class="mb-3 h4">xin chao, user1 (placeholder)</div>
      <div id="timeTable">
        <div class="h6">Lịch uống thuốc của bạn: (chỉ mang tính chất minh họa)</div>
        <table class="table table-striped table-hover" id="timeTable_js">
          <thead>
            <tr>
              <th scope="col">Thứ</th>
              <th scope="col">Giờ</th>
            </tr>
          </thead>
        </table>
      </div>
      <div id="danhSachThuoc">
        <div class="h6">Trong lần uống thuốc này, bạn sẽ uống các loại thuốc sau: </div>
        <ul id="listDrug_js">
          <li><b>Paracetamol</b></li>
          <li><b>Carbocistein 250mg</b></li>
          <li><b>Clorpheniramin 4mg</b></li>
        </ul>
      </div>
      <div id="tutorial">
        <div class="h6">Hướng dẫn lấy thuốc</div>
        <ul>
          <li>Đầu tiên là sử dụng trang web này, nhấn vào <button type="button" id="btn_open_Khoang_js"
              class="btn btn-light">đây</button></li> và chờ một vài giây để máy cấp thuốc xoay đến ô của bạn.
          <li>Thứ hai là sử dụng bộ thẻ đã được cấp: Chạm thẻ vào vùng quét, sau đó đặt ngón tay đã tạo vân tay trước đó
            vào cảm biến vân tay. Cuối cùng là chờ một vài giây để máy cấp thuốc xoay đến ô của bạn.</li>
        </ul>
      </div>
    </main>
  </div>

  <!-- JavaScript Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
    crossorigin="anonymous"></script>

  <!-- socket -->
  <script src="../socket.io/socket.io.js"></script>
  <script>
    var socket = io();

    const control = {
      open: 0,
      khoang: 0,
      changeKhoang: 0,
      changeFingerPrint: 0,
      changeCard: 0,
    }

    const btn_open_Khoang_js = document.querySelector('#btn_open_Khoang_js');
    btn_open_Khoang_js.addEventListener('click', (e) => {
      e.preventDefault();
      control.open = 1;
      // control.khoang = 1; //khoang da duoc cap nhat khi nguoi dung dang nhap
      socket.emit("/web/control", control);
      control.open = 0;
    });

    socket.on('connect', function () {
      console.log('Connected!');
    });


    socket.on("message", (data) => {
      console.log(data);
    });

    socket.on("/web/measure", (data) => {
      console.log(data);
    });
  </script>
  <!-- normal js -->
  <script>
    const hello_js = document.querySelector('#hello_js');
    const listDrug_js = document.querySelector('#listDrug_js');
    const timeTable_js = document.querySelector('#timeTable_js');
    let url = "/getusernumber" + "?" + window.location.href.split('?')[1];
    console.log(url);
    fetch(url)
      .then(res => res.json())
      .then(data => {
        console.log(data);
        hello_js.innerHTML = `Xin chào, ${data.name}!`;
        control.khoang = data.khoang;
        listDrug_js.innerHTML = "";
        data.drugs.forEach(drug => {
          listDrug_js.innerHTML += `<li><b>${drug}</b></li>`;
        });
        const tbody = document.createElement('tbody');
        for (let i = 0; i < data.time.length; i++) {
          const tr = document.createElement('tr');
          if (i != 6) {
            tr.innerHTML = `
              <th scope="row">Thứ ${i + 2}</th>
              <td>${data.time[i]}</td>
            `;
            tbody.appendChild(tr);
          } else {
            tr.innerHTML = `
              <th scope="row">Chủ nhật</th>
              <td>${data.time[i]}</td>`;
            tbody.appendChild(tr);
          }
        }
        timeTable_js.appendChild(tbody);
      })
  </script>
</body>

</html>